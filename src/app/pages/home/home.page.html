<ion-content class="home-content" fullscreen="true">

  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Salud de tu Planta</h1>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="content-wrapper">
    <div class="sensors-grid-compact">
      <div class="sensor-card-compact" *ngFor="let i of [1,2,3,4]">
        <div class="loading-shimmer" style="height: 80px;"></div>
      </div>
    </div>
  </div>

  <!-- Contenido -->
  <div *ngIf="!isLoading" class="content-wrapper">

    <!-- Planta activa -->
    <div class="plant-card" *ngIf="activePlant">
      <div class="plant-card-header">
        <div class="plant-info">
          <h2 class="plant-name">{{ activePlant.name }}</h2>
        </div>
      </div>

      <div class="plant-image-container">
        <img
          [src]="activePlant.imageUrl"
          [alt]="activePlant.name"
          class="plant-image"
          onerror="this.src='assets/plant/default-plant.jpg';"
        >

        <!-- Botón cambiar planta -->
        <button class="change-plant-btn-overlay" (click)="goPlants()">
          <ion-icon name="swap"></ion-icon>
          Cambiar Planta
        </button>
      </div>
    </div>

    <!-- Sin planta -->
    <div class="no-plant-card" *ngIf="!activePlant" (click)="goPlants()">
      <img src="assets/icon/plan.png" alt="No Planta" class="tab-icon no-plant-icon">
      <h3>No hay planta seleccionada</h3>
      <p>Toca aquí para elegir tu planta</p>
    </div>

    <!-- Estado general -->
    <div class="plant-status-bar" *ngIf="activePlant">
      <div class="status-label">Estado de la Planta</div>
      <div class="status-indicator">
        <div class="status-bar">
          <div class="status-fill" [ngClass]="getPlantHealthStatus()"></div>
        </div>
        <div class="status-text" [ngClass]="getPlantHealthStatus()">
          {{ getPlantHealthText() }}
        </div>
      </div>
    </div>

    <!-- Sensores -->
    <div class="sensors-grid-compact">

      <div class="sensor-card-compact">
        <div class="sensor-header-compact">
          <img src="assets/icon/temperatura.png" class="sensor-icon-compact">
          <span class="sensor-title-compact">Temperatura</span>
        </div>
        <div class="sensor-value-compact">{{ data.temp | number:'1.1-1' }}°C</div>
        <div class="sensor-status-compact" [ngClass]="getSensorStatus('temp')">
          {{ getSensorStatusText('temp') }}
        </div>
      </div>

      <div class="sensor-card-compact">
        <div class="sensor-header-compact">
          <img src="assets/icon/humedad.png" class="sensor-icon-compact">
          <span class="sensor-title-compact">Humedad</span>
        </div>
        <div class="sensor-value-compact">{{ data.hum | number:'1.0-0' }}%</div>
        <div class="sensor-status-compact" [ngClass]="getSensorStatus('hum')">
          {{ getSensorStatusText('hum') }}
        </div>
      </div>

      <div class="sensor-card-compact">
        <div class="sensor-header-compact">
          <img src="assets/icon/luz.png" class="sensor-icon-compact">
          <span class="sensor-title-compact">Luz</span>
        </div>
        <div class="sensor-value-compact">{{ data.light | number:'1.0-0' }}%</div>
        <div class="sensor-status-compact" [ngClass]="getSensorStatus('light')">
          {{ getSensorStatusText('light') }}
        </div>
      </div>

      <div class="sensor-card-compact">
        <div class="sensor-header-compact">
          <img src="assets/icon/agua.png" class="sensor-icon-compact">
          <span class="sensor-title-compact">Nivel de Agua</span>
        </div>
        <div class="sensor-value-compact">{{ data.water | number:'1.0-0' }}%</div>
        <div class="sensor-status-compact" [ngClass]="getSensorStatus('water')">
          {{ getSensorStatusText('water') }}
        </div>
      </div>

    </div>
  </div>
</ion-content>

<!-- Tabs -->
<ion-footer class="ion-no-border">
  <ion-toolbar class="tabs-toolbar">
    <div class="custom-tabs">

      <button class="tab-button active" (click)="goHome()">
        <img src="assets/icon/inicio.png" class="tab-icon">
        <span class="tab-label">Inicio</span>
      </button>

      <button class="tab-button" (click)="goHistory()">
        <img src="assets/icon/historial.png" class="tab-icon">
        <span class="tab-label">Historial</span>
      </button>

      <button class="tab-button notifications-tab" (click)="goNotifications()">
        <img src="assets/icon/ti.png" class="tab-icon">
        <span class="tab-label">Notificaciones</span>
        <span class="notification-badge" *ngIf="unreadCount > 0">
          {{ unreadCount }}
        </span>
      </button>

    </div>
  </ion-toolbar>
</ion-footer>
